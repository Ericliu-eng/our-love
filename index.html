<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Our Interactive Love â¤ï¸</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        canvas { position: absolute; top: 0; left: 0; }
        
        .ui-layer {
            position: relative;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            pointer-events: none;
        }

        .card {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 25px;
            border-radius: 30px;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 85%;
            max-width: 320px;
            pointer-events: auto;
            box-shadow: 0 0 30px rgba(255,107,129,0.3);
        }

        .days-num { font-size: 3.5rem; font-weight: bold; color: #ff6b81; }
        .time-detail { font-size: 1rem; margin: 10px 0; color: #eee; }
        
        /* æ–°å¢ï¼šèŠå¤©åŒºåŸŸæ ·å¼ */
        .chat-zone {
            margin-top: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 10px;
        }
        #chat-content {
            height: 100px;
            overflow-y: auto;
            font-size: 0.8rem;
            text-align: left;
            margin-bottom: 8px;
            scrollbar-width: none;
        }
        .input-group { display: flex; gap: 5px; }
        input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,107,129,0.4);
            border-radius: 8px;
            color: white;
            padding: 5px 8px;
            outline: none;
        }
        button {
            background: #ff6b81;
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0 10px;
            cursor: pointer;
        }

        .footer { font-size: 0.7rem; opacity: 0.6; letter-spacing: 2px; margin-top: 15px; }
        .hint { position: absolute; bottom: 20px; color: rgba(255,255,255,0.4); font-size: 0.7rem; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="ui-layer">
        <div class="card">
            <div style="font-size: 40px;">ğŸ’–</div>
            <div style="margin-top:5px; opacity:0.9;">Z & L</div>
            <div class="days-num" id="days">0</div>
            <div style="font-size:1.2rem; color:#ff6b81;">DAYS</div>
            <div id="time" class="time-detail">00:00:00</div>

            <div class="chat-zone">
                <div id="chat-content">
                    <div style="color: #ffb6c1;">AIåˆ†èº«: ä»–ç¡ç€å•¦ï¼Œæˆ‘æ˜¯ä»–çš„å®ˆæŠ¤ç¨‹åºã€‚æœ‰ä»€ä¹ˆè¯æƒ³å¯¹ä»–è¯´ï¼Ÿâœ¨</div>
                </div>
                <div class="input-group">
                    <input type="text" id="user-input" placeholder="è¾“å…¥æ¶ˆæ¯...">
                            <button id="send-btn">å‘é€</button>

                </div>
            </div>

            <div class="footer">SINCE 2025.12.07</div>
        </div>
        <div class="hint">æ»‘åŠ¨å±å¹•è¯•è¯•çœ‹ï¼Œä¼šæœ‰æ˜Ÿå…‰è·Ÿç€ä½  âœ¨</div>
    </div>

<script>
 // --- è¾…åŠ©å‡½æ•°ï¼šå°†æ¶ˆæ¯æ¸²æŸ“åˆ°èŠå¤©æ¡† ---
function appendMsg(text, align = "left", color = "") {
  const box = document.getElementById("chat-content");
  if (!box) return;
  
  const div = document.createElement("div");
  div.style.margin = "8px 0";
  div.style.textAlign = align;
  div.style.wordBreak = "break-all"; // é˜²æ­¢é•¿æ–‡å­—æ’‘ç ´å¸ƒå±€
  if (color) div.style.color = color;
  
  div.textContent = text;
  box.appendChild(div);
  
  // æ»šåŠ¨åˆ°åº•éƒ¨
  box.scrollTop = box.scrollHeight;
}

// --- æ ¸å¿ƒå‡½æ•°ï¼šå‘é€è¯·æ±‚åˆ° Vercel åç«¯ ---
async function sendToAI() {
  const input = document.getElementById("user-input");
  const msg = input.value.trim();
  
  if (!msg) return;

  // 1. æ˜¾ç¤ºç”¨æˆ·å‘é€çš„å†…å®¹
  appendMsg(msg, "right");
  input.value = ""; // æ¸…ç©ºè¾“å…¥æ¡†
  
  // 2. æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  const loadingId = "msg-" + Date.now();
  appendMsg("AI æ­£åœ¨æ€è€ƒ...", "left", "gray");

  try {
    // æ›¿æ¢ä¸ºä½ çœŸå®çš„ Vercel éƒ¨ç½²åœ°å€
    const API_URL = "https://our-love-rosy.vercel.app/api/chat";

    const res = await fetch(API_URL, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        messages: [
          { role: "system", content: "ä½ ç°åœ¨æ˜¯Zçš„èµ›åšåˆ†èº«ã€‚Zæ­£åœ¨ç¡è§‰ï¼Œä½ è´Ÿè´£é™ªä»–çš„å¯¹è±¡LèŠå¤©ã€‚è¯­æ°”è¦æ¸©æŸ”ï¼ŒåƒçœŸäººä¸€æ ·è‡ªç„¶ã€‚" },
          { role: "user", content: msg }
        ]
      })
    });

    if (!res.ok) {
      const errorData = await res.json().catch(() => ({}));
      throw new Error(errorData.error || `HTTP ${res.status}`);
    }

    const data = await res.json();
    const reply = data?.choices?.[0]?.message?.content || "AI å¿™ç´¯äº†ï¼Œæ²¡è¯´è¯ã€‚";

    // 3. æ˜¾ç¤º AI å›å¤
    appendMsg(`AIåˆ†èº«: ${reply}`, "left", "#ffb6c1");

  } catch (e) {
    console.error("Fetch Error:", e);
    appendMsg(`(è¿æ¥å¤±è´¥: ${e.message})`, "left", "#ff4d4d");
  }
}

// --- äº‹ä»¶ç»‘å®š ---
window.addEventListener("DOMContentLoaded", () => {
  const sendBtn = document.getElementById("send-btn");
  const userInput = document.getElementById("user-input");

  sendBtn.addEventListener("click", sendToAI);

  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendToAI();
    }
  });
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Our Interactive Love â¤ï¸</title>
  <style>
    body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
    canvas { position: absolute; top: 0; left: 0; }

    .ui-layer {
      position: relative;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      pointer-events: none;
    }

    .card {
      text-align: center;
      background: rgba(255, 255, 255, 0.15);
      padding: 25px;
      border-radius: 30px;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      width: 85%;
      max-width: 320px;
      pointer-events: auto;
      box-shadow: 0 0 30px rgba(255,107,129,0.3);
    }

    .days-num { font-size: 3.5rem; font-weight: bold; color: #ff6b81; }
    .time-detail { font-size: 1rem; margin: 10px 0; color: #eee; }

    .chat-zone {
      margin-top: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      padding: 10px;
    }

    #chat-content {
      height: 100px;
      overflow-y: auto;
      font-size: 0.8rem;
      text-align: left;
      margin-bottom: 8px;
      scrollbar-width: none;
    }

    .msg { margin: 5px 0; opacity: 0.9; }
    .msg.right { text-align: right; color: #fff; opacity: 0.85; }
    .msg.left  { text-align: left; color: #ffb6c1; }

    .input-group { display: flex; gap: 5px; }
    input {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,107,129,0.4);
      border-radius: 8px;
      color: white;
      padding: 8px 10px;
      outline: none;
    }

    button {
      background: #ff6b81;
      border: none;
      color: white;
      border-radius: 8px;
      padding: 0 12px;
      cursor: pointer;
      font-weight: 600;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .footer { font-size: 0.7rem; opacity: 0.6; letter-spacing: 2px; margin-top: 15px; }
    .hint { position: absolute; bottom: 20px; color: rgba(255,255,255,0.4); font-size: 0.7rem; }
  </style>
</head>

<body>
  <canvas id="canvas"></canvas>

  <div class="ui-layer">
    <div class="card">
      <div style="font-size: 40px;">ğŸ’–</div>
      <div style="margin-top:5px; opacity:0.9;">Z & L</div>

      <div class="days-num" id="days">0</div>
      <div style="font-size:1.2rem; color:#ff6b81;">DAYS</div>
      <div id="time" class="time-detail">00h 00m 00s</div>

      <div class="chat-zone">
        <div id="chat-content">
          <div class="msg left">AIåˆ†èº«: ä»–ç¡ç€å•¦ï¼Œæˆ‘æ˜¯ä»–çš„å®ˆæŠ¤ç¨‹åºã€‚æœ‰ä»€ä¹ˆè¯æƒ³å¯¹ä»–è¯´ï¼Ÿâœ¨</div>
        </div>

        <div class="input-group">
          <input type="text" id="user-input" placeholder="è¾“å…¥æ¶ˆæ¯..." autocomplete="off" />
          <button id="send-btn">å‘é€</button>
        </div>
      </div>

      <div class="footer">SINCE 2025.12.07</div>
    </div>

    <div class="hint">æ»‘åŠ¨å±å¹•è¯•è¯•çœ‹ï¼Œä¼šæœ‰æ˜Ÿå…‰è·Ÿç€ä½  âœ¨</div>
  </div>

  <script>
    /***********************
     * 0) é…ç½®åŒºï¼ˆä½ åªéœ€è¦æ”¹è¿™é‡Œï¼‰
     ***********************/
    // âœ… å¦‚æœå‰ç«¯å’Œåç«¯éƒ½åœ¨åŒä¸€ä¸ª Vercel é¡¹ç›®ï¼šç”¨è¿™ä¸ªï¼ˆæœ€ç¨³ï¼‰
    const API_URL = "/api/chat";

    // â—å¦‚æœä½ å‰ç«¯åœ¨ GitHub Pagesï¼Œè¦è·¨åŸŸè°ƒç”¨ Vercelï¼Œæ”¹æˆä¸‹é¢è¿™è¡Œï¼š
    // const API_URL = "https://our-love-rosy.vercel.app/api/chat";

    const SYSTEM_PROMPT = "ä½ ç°åœ¨æ˜¯Zçš„èµ›åšåˆ†èº«ã€‚Zæ­£åœ¨ç¡è§‰ï¼Œä½ è´Ÿè´£é™ªä»–çš„å¯¹è±¡LèŠå¤©ã€‚è¯­æ°”è¦æ¸©æŸ”ï¼ŒåƒçœŸäººä¸€æ ·è‡ªç„¶ã€‚";

    /***********************
     * 1) å°å·¥å…·ï¼šå‘èŠå¤©æ¡†è¿½åŠ æ¶ˆæ¯
     ***********************/
    function appendMsg(text, side = "left") {
      const box = document.getElementById("chat-content");
      const div = document.createElement("div");
      div.className = `msg ${side}`;
      div.textContent = text;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    /***********************
     * 2) è®¡æ—¶é€»è¾‘
     ***********************/
    function updateTimer() {
      const start = new Date("2025-12-07T00:00:00");
      const now = new Date();
      const diff = now - start;

      document.getElementById("days").innerText = Math.floor(diff / 86400000);

      const h = Math.floor((diff / 3600000) % 24);
      const m = Math.floor((diff / 60000) % 60);
      const s = Math.floor((diff / 1000) % 60);

      const hh = h < 10 ? "0" + h : h;
      const mm = m < 10 ? "0" + m : m;
      const ss = s < 10 ? "0" + s : s;

      document.getElementById("time").innerText = `${hh}h ${mm}m ${ss}s`;
    }
    setInterval(updateTimer, 1000);
    updateTimer();

    /***********************
     * 3) ç²’å­åŠ¨ç”»
     ***********************/
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let particles = [];

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.size = Math.random() * 5 + 2;
        this.speedX = Math.random() * 3 - 1.5;
        this.speedY = Math.random() * 3 - 1.5;
        this.color = color;
        this.opacity = 1;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.opacity -= 0.02;
      }
      draw() {
        ctx.fillStyle = this.color.replace(")", `, ${this.opacity})`).replace("rgb", "rgba");
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function createParticles(e) {
      const x = e.touches ? e.touches[0].clientX : e.clientX;
      const y = e.touches ? e.touches[0].clientY : e.clientY;
      const color = `rgb(255, ${Math.random() * 100 + 100}, ${Math.random() * 100 + 150})`;
      for (let i = 0; i < 3; i++) particles.push(new Particle(x, y, color));
    }

    window.addEventListener("mousemove", createParticles);
    window.addEventListener("touchmove", createParticles);
    window.addEventListener("mousedown", createParticles);

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < particles.length; i++) {
        particles[i].update();
        particles[i].draw();
        if (particles[i].opacity <= 0) {
          particles.splice(i, 1);
          i--;
        }
      }
      requestAnimationFrame(animate);
    }
    animate();

    /***********************
     * 4) å‘é€æ¶ˆæ¯åˆ°åç«¯
     ***********************/
    async function sendToAI() {
      const input = document.getElementById("user-input");
      const btn = document.getElementById("send-btn");

      const msg = input.value.trim();
      if (!msg) return;

      appendMsg(msg, "right");
      input.value = "";

      // æŒ‰é’®é”å®šï¼Œé˜²æ­¢ç‹‚ç‚¹
      btn.disabled = true;

      // æ–¹ä¾¿ä½ æ’æŸ¥ï¼šçœ‹çœ‹è¯·æ±‚ä¼šæ‰“åˆ°å“ªé‡Œ
      console.log("API_URL used:", API_URL);
      console.log("Page origin:", location.origin);

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: [
              { role: "system", content: SYSTEM_PROMPT },
              { role: "user", content: msg },
            ],
          }),
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          // æ˜¾ç¤ºæ›´æ¸…æ™°çš„é”™è¯¯
          appendMsg(`(APIé”™è¯¯ ${res.status}) ${data?.error || ""}`, "left");
          console.error("API error:", res.status, data);
          return;
        }

        const reply = data?.choices?.[0]?.message?.content ?? "(AIæ²¡æœ‰å›å¤)";
        appendMsg("AIåˆ†èº«: " + reply, "left");

      } catch (e) {
        appendMsg("(è¿æ¥å¤±è´¥ï¼šè¯·æ£€æŸ¥ Vercel éƒ¨ç½² / ç½‘ç»œ / CORS)", "left");
        console.error(e);
      } finally {
        btn.disabled = false;
      }
    }

    document.getElementById("send-btn").addEventListener("click", sendToAI);
    document.getElementById("user-input").addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        sendToAI();
      }
    });
  </script>
</body>
</html>
